if("undefined"==typeof Trelloviz)var Trelloviz=function(){};
Trelloviz.viewModel={apiKey:ko.observable(""),loggedIn:ko.observable(!1),fullTrelloUserName:ko.observable(""),trelloLists:ko.observableArray(),showConfigPanel:ko.observable(!1),toggleConfigApiKeyPanelVisible:function(){var a=Trelloviz.viewModel.showConfigPanel();Trelloviz.viewModel.showConfigPanel(!a)},actionLogIn:function(){var a=Trelloviz.viewModel.apiKey();null!=a&&32==a.length?(Trelloviz.viewModel.showConfigPanel(!1),jQuery.getScript("https://api.trello.com/1/client.js?key="+a,Trelloviz_trelloLogin)):
Trelloviz.viewModel.showConfigPanel(!0)},actionLogOut:function(){Trelloviz.viewModel.loggedIn(!1);Trello.deauthorize()},setNewData:function(a){var b=new TrellovizData,a=b.computeVizData_all_lists(a),b=b.retrieveListsWithNaturalOrder();b.reverse();Trelloviz.viewModel.trelloLists(b);Trelloviz_showGraphic(a)}};Trelloviz.trelloLoadAndShowUserInfo=function(){Trello.members.get("me",function(a){Trelloviz.viewModel.fullTrelloUserName(a.fullName)})};
Trelloviz.trelloLoadAndShowBoards=function(){Trello.get("members/me/boards",{},Trelloviz_showBoards)};
var Trelloviz_onAuthorize=function(){var a="undefined"!=typeof Trello&&Trello.authorized();Trelloviz.viewModel.loggedIn(a);a&&(Trelloviz.trelloLoadAndShowUserInfo(),$("#loggedin").fadeIn().delay(2E3).fadeOut(),Trelloviz.trelloLoadAndShowBoards())},Trelloviz_onAuthorizeError=function(){Trelloviz.viewModel.loggedIn(!1)},Trelloviz_trelloLogin=function(){Trello.authorize({interactive:!0,type:"popup",success:Trelloviz_onAuthorize,error:Trelloviz_onAuthorizeError,expiration:"1day",scope:{read:!0,write:!1}})},
Trelloviz_onShowActionForBoard=function(a){Trello.get("boards/"+a+"/actions",{limit:"1000"},Trelloviz.viewModel.setNewData)},Trelloviz_showBoards=function(a){var b=[],c={id:a[0].id,name:a[0].name};$("#selectBoardCombo").empty();$("#btnShowChart").click(function(){Trelloviz_onShowActionForBoard(c.id)});$.each(a,function(a,d){var e=$("<option value="+d.id+">").text(d.name).appendTo("#selectBoardCombo");b.push(e[0]);$(e).click(function(a){c.id=a.target.value;c.name=a.target.text})})},Trelloviz_showGraphic=
function(a){$("#graphic").empty();$('<div id="viz_container" style="min-height: 700px">').appendTo("#graphic");$('<div id="viz_canvas" style="min-height: 700px">').appendTo("#viz_container");(new $jit.AreaChart({injectInto:"viz_canvas",animate:!0,Margin:{top:5,left:5,right:5,bottom:5},labelOffset:10,showAggregates:!0,showLabels:!0,type:"stacked:gradient",Tips:{enable:!0,onShow:function(a,c){$(a).empty();$("<span>").addClass("label").addClass("label-info").text(""+c.name+" ("+c.value+")").appendTo(a)}},
filterOnClick:!1,restoreOnRightClick:!0})).loadJSON(a)};
